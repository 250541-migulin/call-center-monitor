{
  "info": {
    "name": "Call Center Monitor API",
    "description": "–ö–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–ª–ª-—Ü–µ–Ω—Ç—Ä–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Asterisk",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "testCallId",
      "value": "test-call-001",
      "type": "string"
    },
    {
      "key": "testCallerId",
      "value": "+79991234567",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üìÅ 1. –í—ã–∑–æ–≤—ã (Calls)",
      "item": [
        {
          "name": "GET –í—Å–µ –≤—ã–∑–æ–≤—ã –≤ –æ—á–µ—Ä–µ–¥–∏",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/calls",
              "host": ["{{baseUrl}}"],
              "path": ["api", "calls"]
            },
            "description": "–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏ (–∏–∑ –ø–∞–º—è—Ç–∏)"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response is array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an(\"array\");",
                  "});",
                  "",
                  "console.log(\"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤: \" + pm.response.json().length);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "GET –í—ã–∑–æ–≤ –ø–æ ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/calls/{{testCallId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "calls", "{{testCallId}}"]
            },
            "description": "–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –≤—ã–∑–æ–≤–µ –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Response status is 200 or 404\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.test(\"Response has callId\", function () {",
                  "        pm.expect(jsonData).to.have.property('callId');",
                  "    });",
                  "    pm.test(\"Response has callerId\", function () {",
                  "        pm.expect(jsonData).to.have.property('callerId');",
                  "    });",
                  "}",
                  "",
                  "if (pm.response.code === 404) {",
                  "    console.log(\"–í—ã–∑–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "POST –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"callId\": \"{{testCallId}}\",\n  \"callerId\": \"{{testCallerId}}\",\n  \"queueName\": \"support\",\n  \"entryTime\": \"{{currentTimestamp}}\",\n  \"status\": \"WAITING\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/calls",
              "host": ["{{baseUrl}}"],
              "path": ["api", "calls"]
            },
            "description": "–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã API (–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏)"
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É",
                  "var now = new Date();",
                  "pm.environment.set(\"currentTimestamp\", now.toISOString());"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "pm.test(\"Response has correct callId\", function () {",
                  "    pm.expect(jsonData.callId).to.eql(pm.variables.get(\"testCallId\"));",
                  "});",
                  "",
                  "pm.test(\"Response has status\", function () {",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});",
                  "",
                  "console.log(\"–¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ —Å–æ–∑–¥–∞–Ω: \" + jsonData.callId);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "DELETE –£–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/calls/{{testCallId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "calls", "{{testCallId}}"]
            },
            "description": "–£–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤ –∏–∑ –ø–∞–º—è—Ç–∏ (–¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 204\", function () {",
                  "    pm.response.to.have.status(204);",
                  "});",
                  "",
                  "console.log(\"–í—ã–∑–æ–≤ —É–¥–∞–ª—ë–Ω: \" + pm.variables.get(\"testCallId\"));"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ],
      "description": "API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–∑–æ–≤–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏ –∫–æ–ª–ª-—Ü–µ–Ω—Ç—Ä–∞"
    },
    {
      "name": "üìÅ 2. Health Check",
      "item": [
        {
          "name": "GET Health Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/health",
              "host": ["{{baseUrl}}"],
              "path": ["api", "health"]
            },
            "description": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Asterisk AMI"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Response status is 200 or 503\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 503]);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "pm.test(\"Response has status field\", function () {",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});",
                  "",
                  "pm.test(\"Response has asteriskConnected field\", function () {",
                  "    pm.expect(jsonData).to.have.property('asteriskConnected');",
                  "});",
                  "",
                  "if (jsonData.asteriskConnected) {",
                  "    console.log(\"‚úÖ Asterisk AMI –ø–æ–¥–∫–ª—é—á—ë–Ω\");",
                  "} else {",
                  "    console.log(\"‚ùå Asterisk AMI –ù–ï –ø–æ–¥–∫–ª—é—á—ë–Ω\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "GET Connection Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/health/details",
              "host": ["{{baseUrl}}"],
              "path": ["api", "health", "details"]
            },
            "description": "–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Asterisk AMI"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "pm.test(\"Response has connected field\", function () {",
                  "    pm.expect(jsonData).to.have.property('connected');",
                  "});",
                  "",
                  "pm.test(\"Response has connectionState field\", function () {",
                  "    pm.expect(jsonData).to.have.property('connectionState');",
                  "});",
                  "",
                  "console.log(\"–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: \" + jsonData.connectionState);",
                  "console.log(\"–•–æ—Å—Ç: \" + jsonData.host + \":\" + jsonData.port);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ],
      "description": "–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Asterisk"
    },
    {
      "name": "üìÅ 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏",
      "item": [
        {
          "name": "–°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "console.log(\"–ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è...\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "item": [
            {
              "name": "–®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"callId\": \"{{testCallId}}\",\n  \"callerId\": \"{{testCallerId}}\",\n  \"queueName\": \"support\",\n  \"entryTime\": \"{{currentTimestamp}}\",\n  \"status\": \"WAITING\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/api/calls",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "calls"]
                }
              },
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "var now = new Date();",
                      "pm.environment.set(\"currentTimestamp\", now.toISOString());"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"‚úÖ –®–∞–≥ 1: –í—ã–∑–æ–≤ —Å–æ–∑–¥–∞–Ω\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var jsonData = pm.response.json();",
                      "pm.environment.set(\"createdCallId\", jsonData.callId);"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—ã–∑–æ–≤–æ–≤",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/calls",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "calls"]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"‚úÖ –®–∞–≥ 2: –°–ø–∏—Å–æ–∫ –≤—ã–∑–æ–≤–æ–≤ –ø–æ–ª—É—á–µ–Ω\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var calls = pm.response.json();",
                      "pm.test(\"–í —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤—ã–∑–æ–≤\", function () {",
                      "    var createdCallId = pm.environment.get(\"createdCallId\");",
                      "    var found = calls.some(call => call.callId === createdCallId);",
                      "    pm.expect(found).to.be.true;",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "–®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç—å –≤—ã–∑–æ–≤ –ø–æ ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/calls/{{createdCallId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "calls", "{{createdCallId}}"]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"‚úÖ –®–∞–≥ 3: –í—ã–∑–æ–≤ –ø–æ–ª—É—á–µ–Ω –ø–æ ID\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "var call = pm.response.json();",
                      "pm.test(\"Call ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç\", function () {",
                      "    pm.expect(call.callId).to.eql(pm.environment.get(\"createdCallId\"));",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "–®–∞–≥ 4: –£–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤",
              "request": {
                "method": "DELETE",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/api/calls/{{createdCallId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "calls", "{{createdCallId}}"]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"‚úÖ –®–∞–≥ 4: –í—ã–∑–æ–≤ —É–¥–∞–ª—ë–Ω\", function () {",
                      "    pm.response.to.have.status(204);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "–®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã–∑–æ–≤ —É–¥–∞–ª—ë–Ω",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/calls/{{createdCallId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "calls", "{{createdCallId}}"]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"‚úÖ –®–∞–≥ 5: –í—ã–∑–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω (404)\", function () {",
                      "    pm.response.to.have.status(404);",
                      "});",
                      "",
                      "console.log(\"\\nüéâ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!\");"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "–°—Ü–µ–Ω–∞—Ä–∏–π: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã",
          "item": [
            {
              "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/health",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "health"]
                }
              }
            },
            {
              "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—Ç–∞–ª–µ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/api/health/details",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "health", "details"]
                }
              }
            }
          ]
        }
      ],
      "description": "–ì–æ—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
    }
  ]
}