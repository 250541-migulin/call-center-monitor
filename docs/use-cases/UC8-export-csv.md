# UC8: Экспортировать отчёт в CSV

## Актёр
Руководитель

## Описание
Руководитель сохраняет текущую выборку данных (звонки, обращения, статистика) в файл формата CSV для дальнейшего анализа, отчётности или архивирования.  
Экспорт учитывает **применённые фильтры** (UC7) и **выбранную вкладку** (звонки / статистика).

## Предусловия
- Руководитель находится на странице с табличными данными («Все звонки», «История обращений», «Статистика по операторам»).
- В системе есть данные, соответствующие текущему фильтру (или без фильтра).

## Основной поток событий (Flow of Events)
1. Руководитель нажимает кнопку **«Экспорт в CSV»** (расположена над таблицей, рядом с фильтрами).
2. Система показывает индикатор загрузки: **«Формирование отчёта...»**.
3. Система формирует CSV-файл на сервере:
   - Кодировка: **UTF-8 с BOM** (для корректного отображения кириллицы в Excel),
   - Заголовки столбцов: `Дата`, `Оператор`, `Клиент`, `Ресурс`, `Тема`, `Результат`, `Комментарий` (набор зависит от контекста),
   - Данные: только строки, видимые в таблице (с учётом фильтров).
4. Система инициирует загрузку файла в браузере.
5. Файл сохраняется на устройство пользователя с именем:  
   `call-center-report_2026-01-27_14-30.csv` (формат: `YYYY-MM-DD_HH-MM`).
6. Система отображает сообщение: **«Отчёт успешно экспортирован»** на 3 секунды.

## Альтернативные потоки

### A1: Нет данных для экспорта
1. На шаге 3 система обнаруживает, что выборка пуста.
2. Система отменяет экспорт и показывает: **«Нет данных для экспорта»**.

### A2: Ошибка генерации файла
1. На шаге 3 возникает ошибка (недостаточно памяти, сбой сервера).
2. Система отменяет экспорт и показывает: **«Не удалось создать отчёт. Повторите попытку позже»**.

### A3: Отмена загрузки пользователем
1. Браузер предлагает сохранить файл.
2. Пользователь нажимает **«Отмена»** в диалоге загрузки.
3. Система не отображает никакого сообщения (операция завершена на стороне клиента).

## Постусловия
- На устройстве пользователя сохранён файл в формате CSV с актуальными данными.
- Файл открывается корректно в Excel, Google Sheets, LibreOffice Calc.
- Содержимое файла **точно соответствует** тому, что отображается в интерфейсе на момент экспорта.

## Примечание
- Формат даты в CSV: `YYYY-MM-DD HH:MM`.
- Для статистики (UC6) структура CSV отличается:  
  `Оператор`, `Входящие`, `Принятые`, `Пропущенные`, `% решённых`, `Средняя длительность`.
- Кнопка экспорта должна быть видна в ![Мокап руководителя](/docs/mocks/admin-view.png).