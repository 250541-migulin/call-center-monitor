# UC5: Просмотреть историю обращений клиента

## Актёр
Оператор, Руководитель

## Описание
Пользователь просматривает полную историю взаимодействий с конкретным клиентом, включая даты, темы, ресурсы, результаты и комментарии.  
Интерфейс адаптирован под роль:  
- **Оператор** — видит историю в контексте текущего звонка,  
- **Руководитель** — может просматривать историю любого клиента из общего списка.

## Предусловия
- Клиент существует в системе (имеет карточку).
- У клиента есть хотя бы одно зафиксированное обращение *(для основного потока)*.

## Основной поток событий (Flow of Events)
1. Пользователь открывает карточку клиента:
   - **Оператор**: автоматически после завершения звонка или через поиск,
   - **Руководитель**: из раздела «Клиенты» или через фильтр в журнале звонков.
2. Система отображает основные данные клиента:
   - Имя, телефон,
   - Дата первого и последнего звонка,
   - Общее количество обращений.
3. Пользователь нажимает кнопку **«Показать историю обращений»**.
4. Система запрашивает данные у сервиса истории (`InteractionHistoryService`).
5. Система получает список обращений из базы данных.
6. Система отображает таблицу обращений в **обратном хронологическом порядке** (новые сверху).
7. Каждая строка таблицы содержит:
   - Дату и время,
   - Ресурс,
   - Тему обращения,
   - Результат (иконка ✅ / ❌ или текст),
   - Комментарий (укороченный, с возможностью раскрыть),
   - Имя оператора.

## Альтернативные потоки

### A1: Нет обращений у клиента
1. На шаге 5 система получает пустой список.
2. Система отображает сообщение: **«Нет записей в истории обращений»** вместо таблицы.

### A2: Ошибка загрузки данных
1. На шаге 5 возникает ошибка подключения к БД или таймаут.
2. Система показывает: **«Не удалось загрузить историю. Повторите попытку позже»**.
3. Пользователь может нажать кнопку **«Повторить»** для повторной загрузки.

### A3: Сортировка по дате
1. Пользователь нажимает на заголовок столбца **«Дата»**.
2. Система переключает порядок сортировки:  
   - По умолчанию: новые сверху → старые сверху → новые сверху...

### A4: Закрытие окна истории
1. Пользователь нажимает **«Закрыть»** или **«Назад»**.
2. Система возвращает его к предыдущему экрану (карточка клиента или список клиентов).

## Постусловия
- Пользователь получает полную картину взаимодействия с клиентом.
- Информация используется:
  - **Оператором** — для контекстного обслуживания,
  - **Руководителем** — для анализа качества работы операторов и выявления проблемных клиентов.

## Примечание
- В интерфейсе [оператора](/docs/mocks/operator-view.png) история отображается как часть карточки.
- В интерфейсе  [руководителя](/docs/mocks/admin-view.png). история может быть отдельной страницей с расширенными возможностями (экспорт, фильтрация).