@startuml
title UC3: Обработать звонок и зафиксировать обращение

skinparam wrapWidth 30
skinparam activityFontSize 12

start

:Звонок завершён\n(получено HangupEvent);
:Система открывает форму\n«Новое обращение»;

if (Карточка клиента\nзаполнена?) then (Да)
  :Выбрать Ресурс\n(обязательно);
  :Выбрать Тему\n(обязательно);
  :Указать Результат\n(Решено / Не решено);
  :Ввести Комментарий\n(опционально);
  
  if (Нажата «Сохранить»?) then (Да)
    if (Обязательные поля\nзаполнены?) then (Да)
      :Сохранить в БД;
      :Обновить статистику;
      :Показать:\n«Успешно сохранено»;
      stop
    else (Нет)
      :Ошибка:\n«Ресурс и Тема обязательны»;
      stop
    endif
  else (Нажата «Отмена»?)
    :Подтвердить отмену?;
    if (Да) then (Да)
      stop
    else (Нет)
      :Остаться в форме;
      stop
    endif
  endif
  
else (Нет)
  :Предупреждение:\n«Имя не указано»;
  :Переход к UC4:\n«Заполнить карточку»;
  note right
    После завершения UC4\nоператор возвращается\nк заполнению обращения
  end note
  stop
endif

@enduml